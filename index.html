<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ì§€ë¬¸ ìˆ˜ì • + ë§ˆìŠ¤í‚¹ + ì±„ì  ì›¹ì•±</title>
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 800px; margin: auto; }
    textarea, input[type=range], button { width: 100%; margin: 10px 0; padding: 10px; font-size: 16px; }
    #output { line-height: 2; white-space: pre-wrap; background: #f9f9f9; padding: 10px; border: 1px solid #ccc; min-height: 100px; }
    input[type=text] { border: 1px solid #ccc; padding: 4px; min-width: 50px; }
    input.correct { background-color: #c8f7c5; }
    input.incorrect { background-color: #f7c5c5; }
    .checkbox { margin-bottom: 5px; }
    #copyMessage { font-size: 14px; color: green; display: none; margin-bottom: 10px; }
  </style>
</head>
<body>
  <h2>ğŸ“š ì§€ë¬¸ ìˆ˜ì • + ë§ˆìŠ¤í‚¹ + ì±„ì  ì›¹ì•±</h2>

  <button onclick="toggleEditor()">âœï¸ ì§€ë¬¸ ìˆ˜ì •</button>
  <div id="editorSection" style="display:none;">
    <h4>ğŸ“„ Markdown ì§€ë¬¸ í¸ì§‘ê¸°</h4>
    <textarea id="markdownInput" rows="10"></textarea>
    <button onclick="applyMarkdown()">ğŸ’¾ ì§€ë¬¸ ì €ì¥ ë° ë°˜ì˜</button>
  </div>

  <div id="passageList">ì§€ë¬¸ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>

  <label for="difficultyRange">ë‚œì´ë„ ì¡°ì ˆ: <span id="percentLabel">20%</span></label>
  <input type="range" id="difficultyRange" min="10" max="100" value="20" step="1">

  <button id="runButton">ğŸ” ë§ˆìŠ¤í‚¹ ì‹œì‘</button>
  <button id="gradeButton">âœ… ì±„ì </button>

  <h3>ğŸ“˜ ì¶œë ¥ ê²°ê³¼:</h3>
  <div id="output"></div>
  <div id="copyMessage">ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!</div>

  <script>
    const passageList = document.getElementById("passageList");
    const percentLabel = document.getElementById("percentLabel");
    const rangeInput = document.getElementById("difficultyRange");
    const runButton = document.getElementById("runButton");
    const gradeButton = document.getElementById("gradeButton");
    const outputDiv = document.getElementById("output");
    const markdownInput = document.getElementById("markdownInput");
    let passages = [];
    let correctAnswers = [];

    // ğŸ”„ ì§€ë¬¸ ì—ë””í„° toggle
    function toggleEditor() {
      const section = document.getElementById("editorSection");
      section.style.display = section.style.display === "none" ? "block" : "none";
    }

    // âœ… ì§€ë¬¸ Markdown â†’ passagesë¡œ ë³€í™˜
    function parseMarkdown(md) {
      const split = md.split(/^##\s+/gm).filter(p => p.trim());
      return split.map(p => {
        const lines = p.trim().split("\n");
        return {
          title: lines[0].trim(),
          content: lines.slice(1).join(" ").trim()
        };
      });
    }

    // âœ… ì²´í¬ë°•ìŠ¤ ëª©ë¡ ë‹¤ì‹œ ê·¸ë¦¬ê¸°
    function renderPassageList() {
      passageList.innerHTML = passages.map((p, i) =>
        `<div class="checkbox">
           <label><input type="checkbox" value="${i}"> ${p.title}</label>
         </div>`
      ).join("");
    }

    // âœ… ì—ë””í„° ë‚´ìš© ì €ì¥ â†’ passages ë°˜ì˜
    function applyMarkdown() {
      const mdText = markdownInput.value;
      passages = parseMarkdown(mdText);
      renderPassageList();
      alert("âœ… ì§€ë¬¸ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!");
    }

    // âœ… ì´ˆê¸° ë°ì´í„° (ìƒ˜í”Œ ì§€ë¬¸)
    const defaultMarkdown = `## Passage 1
The quick brown fox jumps over the lazy dog.

## Passage 2
Language learning opens the door to new worlds.

## Passage 3
Reading gives us someplace to go when we have to stay where we are.`;

    // âœ… ì´ˆê¸° ë¡œë”©
    window.onload = () => {
      markdownInput.value = defaultMarkdown;
      passages = parseMarkdown(defaultMarkdown);
      renderPassageList();
      percentLabel.textContent = rangeInput.value + "%";
    };

    rangeInput.addEventListener("input", () => {
      percentLabel.textContent = rangeInput.value + "%";
    });

    runButton.addEventListener("click", () => {
      const selected = Array.from(document.querySelectorAll("#passageList input:checked"))
        .map(cb => passages[parseInt(cb.value)]);
      if (selected.length === 0) {
        outputDiv.innerText = "(ì§€ë¬¸ì„ ì„ íƒí•˜ì„¸ìš”)";
        return;
      }

      const text = selected.map(p => p.content).join(" ");
      const percent = parseInt(rangeInput.value, 10);
      const words = text.match(/\b\w+\b/g);
      if (!words) {
        outputDiv.innerText = "(ë‹¨ì–´ ì—†ìŒ)";
        return;
      }

      const total = words.length;
      const numToMask = percent === 100 ? total : Math.floor(total * (percent / 100));
      const indices = new Set();
      while (indices.size < numToMask) {
        indices.add(Math.floor(Math.random() * total));
      }

      correctAnswers = [...words];
      let pointer = 0;
      const html = text.replace(/\b\w+\b/g, () => {
        const word = words[pointer];
        let result;
        if (indices.has(pointer) && word.length > 1) {
          result = `<input type="text" data-ans="${word}" placeholder="${word[0]}" maxlength="${word.length - 1}">`;
        } else {
          result = word;
        }
        pointer++;
        return result;
      });

      outputDiv.innerHTML = html;
    });

    gradeButton.addEventListener("click", () => {
      const inputs = outputDiv.querySelectorAll("input[type=text]");
      let correct = 0;
      inputs.forEach(input => {
        const expected = input.dataset.ans;
        const userInput = input.value.trim();
        const compare = expected.slice(1);
        if (userInput.toLowerCase() === compare.toLowerCase()) {
          input.classList.add("correct");
          input.classList.remove("incorrect");
          correct++;
        } else {
          input.classList.add("incorrect");
          input.classList.remove("correct");
        }
      });

      const percent = inputs.length > 0 ? Math.round((correct / inputs.length) * 100) : 0;
      alert(`âœ… ${correct}/${inputs.length} ì •ë‹µ (${percent}%)`);
    });
  </script>
</body>
</html>
